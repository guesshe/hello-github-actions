name: Add comment to PR

on:
  pull_request:
    type: opened

jobs:
  add_comment:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 14

    - name: Install dependencies
      run: npm install @octokit/rest

    - name: Add comment to PR
      uses: actions/github-script@0.8.0
      with:
        github-token: ${{ secrets.TEST_AUTO }}
        script: |
          const octokit = require('@octokit/rest')();
          octokit.authenticate({
            type: 'token',
            token: process.env.TEST_AUTO,
          });
          octokit.pulls.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: context.payload.pull_request.number,
            body: 'This is an automated comment added by GitHub Actions.',
          });
